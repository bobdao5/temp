import{c as w}from"./@ethereumjs-ec0ac526.js";import{r as H}from"./engine.io-parser-3c63afea.js";import{r as z}from"./@socket.io-27564b7e.js";import{r as F}from"./debug-6f842070.js";var X={},O={},j={},q={},C={},T={},E={},N;function A(){return N||(N=1,Object.defineProperty(E,"__esModule",{value:!0}),E.globalThisShim=void 0,E.globalThisShim=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())()),E}var $;function U(){if($)return T;$=1,Object.defineProperty(T,"__esModule",{value:!0}),T.byteLength=T.installTimerFunctions=T.pick=void 0;const n=A();function g(i,...s){return s.reduce((r,e)=>(i.hasOwnProperty(e)&&(r[e]=i[e]),r),{})}T.pick=g;const l=n.globalThisShim.setTimeout,d=n.globalThisShim.clearTimeout;function h(i,s){s.useNativeTimers?(i.setTimeoutFn=l.bind(n.globalThisShim),i.clearTimeoutFn=d.bind(n.globalThisShim)):(i.setTimeoutFn=n.globalThisShim.setTimeout.bind(n.globalThisShim),i.clearTimeoutFn=n.globalThisShim.clearTimeout.bind(n.globalThisShim))}T.installTimerFunctions=h;const c=1.33;function f(i){return typeof i=="string"?m(i):Math.ceil((i.byteLength||i.size)*c)}T.byteLength=f;function m(i){let s=0,r=0;for(let e=0,t=i.length;e<t;e++)s=i.charCodeAt(e),s<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(e++,r+=4);return r}return T}var P={},G;function ae(){if(G)return P;G=1,Object.defineProperty(P,"__esModule",{value:!0}),P.decode=P.encode=void 0;function n(l){let d="";for(let h in l)l.hasOwnProperty(h)&&(d.length&&(d+="&"),d+=encodeURIComponent(h)+"="+encodeURIComponent(l[h]));return d}P.encode=n;function g(l){let d={},h=l.split("&");for(let c=0,f=h.length;c<f;c++){let m=h[c].split("=");d[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return d}return P.decode=g,P}var V;function I(){if(V)return C;V=1;var n=w&&w.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(C,"__esModule",{value:!0}),C.Transport=void 0;const g=H(),l=z,d=U(),h=n(F()),c=ae(),f=(0,h.default)("engine.io-client:transport");class m extends Error{constructor(r,e,t){super(r),this.description=e,this.context=t,this.type="TransportError"}}class i extends l.Emitter{constructor(r){super(),this.writable=!1,(0,d.installTimerFunctions)(this,r),this.opts=r,this.query=r.query,this.socket=r.socket}onError(r,e,t){return super.emitReserved("error",new m(r,e,t)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(r){this.readyState==="open"?this.write(r):f("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(r){const e=(0,g.decodePacket)(r,this.socket.binaryType);this.onPacket(e)}onPacket(r){super.emitReserved("packet",r)}onClose(r){this.readyState="closed",super.emitReserved("close",r)}pause(r){}createUri(r,e={}){return r+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const r=this.opts.hostname;return r.indexOf(":")===-1?r:"["+r+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(r){const e=(0,c.encode)(r);return e.length?"?"+e:""}}return C.Transport=i,C}var k={},K;function ce(){if(K)return k;K=1,Object.defineProperty(k,"__esModule",{value:!0}),k.yeast=k.decode=k.encode=void 0;const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),g=64,l={};let d=0,h=0,c;function f(s){let r="";do r=n[s%g]+r,s=Math.floor(s/g);while(s>0);return r}k.encode=f;function m(s){let r=0;for(h=0;h<s.length;h++)r=r*g+l[s.charAt(h)];return r}k.decode=m;function i(){const s=f(+new Date);return s!==c?(d=0,c=s):s+"."+f(d++)}for(k.yeast=i;h<g;h++)l[n[h]]=h;return k}var R={},L={},Y;function le(){if(Y)return L;Y=1,Object.defineProperty(L,"__esModule",{value:!0}),L.hasCORS=void 0;let n=!1;try{n=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}return L.hasCORS=n,L}var Q;function pe(){if(Q)return R;Q=1,Object.defineProperty(R,"__esModule",{value:!0}),R.createCookieJar=R.XHR=void 0;const n=le(),g=A();function l(h){const c=h.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!c||n.hasCORS))return new XMLHttpRequest}catch{}if(!c)try{return new g.globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}R.XHR=l;function d(){}return R.createCookieJar=d,R}var Z;function de(){if(Z)return q;Z=1;var n=w&&w.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(q,"__esModule",{value:!0}),q.Request=q.Polling=void 0;const g=I(),l=n(F()),d=ce(),h=H(),c=pe(),f=z,m=U(),i=A(),s=(0,l.default)("engine.io-client:polling");function r(){}const e=function(){return new c.XHR({xdomain:!1}).responseType!=null}();class t extends g.Transport{constructor(a){if(super(a),this.polling=!1,typeof location<"u"){const u=location.protocol==="https:";let v=location.port;v||(v=u?"443":"80"),this.xd=typeof location<"u"&&a.hostname!==location.hostname||v!==a.port}const p=a&&a.forceBase64;this.supportsBinary=e&&!p,this.opts.withCredentials&&(this.cookieJar=(0,c.createCookieJar)())}get name(){return"polling"}doOpen(){this.poll()}pause(a){this.readyState="pausing";const p=()=>{s("paused"),this.readyState="paused",a()};if(this.polling||!this.writable){let u=0;this.polling&&(s("we are currently polling - waiting to pause"),u++,this.once("pollComplete",function(){s("pre-pause polling complete"),--u||p()})),this.writable||(s("we are currently writing - waiting to pause"),u++,this.once("drain",function(){s("pre-pause writing complete"),--u||p()}))}else p()}poll(){s("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(a){s("polling got data %s",a);const p=u=>{if(this.readyState==="opening"&&u.type==="open"&&this.onOpen(),u.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(u)};(0,h.decodePayload)(a,this.socket.binaryType).forEach(p),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this.poll():s('ignoring poll - transport state "%s"',this.readyState))}doClose(){const a=()=>{s("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(s("transport open - closing"),a()):(s("transport not open - deferring close"),this.once("open",a))}write(a){this.writable=!1,(0,h.encodePayload)(a,p=>{this.doWrite(p,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const a=this.opts.secure?"https":"http",p=this.query||{};return this.opts.timestampRequests!==!1&&(p[this.opts.timestampParam]=(0,d.yeast)()),!this.supportsBinary&&!p.sid&&(p.b64=1),this.createUri(a,p)}request(a={}){return Object.assign(a,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new o(this.uri(),a)}doWrite(a,p){const u=this.request({method:"POST",data:a});u.on("success",p),u.on("error",(v,D)=>{this.onError("xhr post error",v,D)})}doPoll(){s("xhr poll");const a=this.request();a.on("data",this.onData.bind(this)),a.on("error",(p,u)=>{this.onError("xhr poll error",p,u)}),this.pollXhr=a}}q.Polling=t;class o extends f.Emitter{constructor(a,p){super(),(0,m.installTimerFunctions)(this,p),this.opts=p,this.method=p.method||"GET",this.uri=a,this.data=p.data!==void 0?p.data:null,this.create()}create(){var a;const p=(0,m.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");p.xdomain=!!this.opts.xd;const u=this.xhr=new c.XHR(p);try{s("xhr open %s: %s",this.method,this.uri),u.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let v in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(v)&&u.setRequestHeader(v,this.opts.extraHeaders[v])}}catch{}if(this.method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(a=this.opts.cookieJar)===null||a===void 0||a.addCookies(u),"withCredentials"in u&&(u.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(u.timeout=this.opts.requestTimeout),u.onreadystatechange=()=>{var v;u.readyState===3&&((v=this.opts.cookieJar)===null||v===void 0||v.parseCookies(u)),u.readyState===4&&(u.status===200||u.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof u.status=="number"?u.status:0)},0))},s("xhr data %s",this.data),u.send(this.data)}catch(v){this.setTimeoutFn(()=>{this.onError(v)},0);return}typeof document<"u"&&(this.index=o.requestsCount++,o.requests[this.index]=this)}onError(a){this.emitReserved("error",a,this.xhr),this.cleanup(!0)}cleanup(a){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=r,a)try{this.xhr.abort()}catch{}typeof document<"u"&&delete o.requests[this.index],this.xhr=null}}onLoad(){const a=this.xhr.responseText;a!==null&&(this.emitReserved("data",a),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(q.Request=o,o.requestsCount=0,o.requests={},typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",b);else if(typeof addEventListener=="function"){const y="onpagehide"in i.globalThisShim?"pagehide":"unload";addEventListener(y,b,!1)}}function b(){for(let y in o.requests)o.requests.hasOwnProperty(y)&&o.requests[y].abort()}return q}var B={},_={},ee;function J(){if(ee)return _;ee=1,Object.defineProperty(_,"__esModule",{value:!0}),_.defaultBinaryType=_.usingBrowserWebSocket=_.WebSocket=_.nextTick=void 0;const n=A();return _.nextTick=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?l=>Promise.resolve().then(l):(l,d)=>d(l,0))(),_.WebSocket=n.globalThisShim.WebSocket||n.globalThisShim.MozWebSocket,_.usingBrowserWebSocket=!0,_.defaultBinaryType="arraybuffer",_}var te;function fe(){if(te)return B;te=1;var n=w&&w.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(B,"__esModule",{value:!0}),B.WS=void 0;const g=I(),l=ce(),d=U(),h=J(),c=n(F()),f=H(),m=(0,c.default)("engine.io-client:websocket"),i=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class s extends g.Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,o=i?{}:(0,d.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(o.headers=this.opts.extraHeaders);try{this.ws=h.usingBrowserWebSocket&&!i?t?new h.WebSocket(e,t):new h.WebSocket(e):new h.WebSocket(e,t,o)}catch(b){return this.emitReserved("error",b)}this.ws.binaryType=this.socket.binaryType||h.defaultBinaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const o=e[t],b=t===e.length-1;(0,f.encodePacket)(o,this.supportsBinary,y=>{const a={};h.usingBrowserWebSocket||(o.options&&(a.compress=o.options.compress),this.opts.perMessageDeflate&&(typeof y=="string"?Buffer.byteLength(y):y.length)<this.opts.perMessageDeflate.threshold&&(a.compress=!1));try{h.usingBrowserWebSocket?this.ws.send(y):this.ws.send(y,a)}catch{m("websocket closed before onclose event")}b&&(0,h.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,l.yeast)()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!h.WebSocket}}return B.WS=s,B}var W={},re;function ge(){if(re)return W;re=1;var n=w&&w.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(W,"__esModule",{value:!0}),W.WT=void 0;const g=I(),l=J(),d=H(),c=(0,n(F()).default)("engine.io-client:webtransport");function f(i,s){return i.type==="message"&&typeof i.data!="string"&&s[0]>=48&&s[0]<=54}class m extends g.Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{c("transport closed gracefully"),this.onClose()}).catch(s=>{c("transport closed due to %s",s),this.onError("webtransport error",s)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(s=>{const r=s.readable.getReader();this.writer=s.writable.getWriter();let e;const t=()=>{r.read().then(({done:b,value:y})=>{if(b){c("session is closed");return}c("received chunk: %o",y),!e&&y.byteLength===1&&y[0]===54?e=!0:(this.onPacket((0,d.decodePacketFromBinary)(y,e,"arraybuffer")),e=!1),t()}).catch(b=>{c("an error occurred while reading: %s",b)})};t();const o=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(o)).then(()=>this.onOpen())})}))}write(s){this.writable=!1;for(let r=0;r<s.length;r++){const e=s[r],t=r===s.length-1;(0,d.encodePacketToBinary)(e,o=>{f(e,o)&&(c("writing binary header"),this.writer.write(Uint8Array.of(54))),c("writing chunk: %o",o),this.writer.write(o).then(()=>{t&&(0,l.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var s;(s=this.transport)===null||s===void 0||s.close()}}return W.WT=m,W}var se;function he(){if(se)return j;se=1,Object.defineProperty(j,"__esModule",{value:!0}),j.transports=void 0;const n=de(),g=fe(),l=ge();return j.transports={websocket:g.WS,webtransport:l.WT,polling:n.Polling},j}var M={},ie;function ue(){if(ie)return M;ie=1,Object.defineProperty(M,"__esModule",{value:!0}),M.parse=void 0;const n=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,g=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function l(c){const f=c,m=c.indexOf("["),i=c.indexOf("]");m!=-1&&i!=-1&&(c=c.substring(0,m)+c.substring(m,i).replace(/:/g,";")+c.substring(i,c.length));let s=n.exec(c||""),r={},e=14;for(;e--;)r[g[e]]=s[e]||"";return m!=-1&&i!=-1&&(r.source=f,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=d(r,r.path),r.queryKey=h(r,r.query),r}M.parse=l;function d(c,f){const m=/\/{2,9}/g,i=f.replace(m,"/").split("/");return(f.slice(0,1)=="/"||f.length===0)&&i.splice(0,1),f.slice(-1)=="/"&&i.splice(i.length-1,1),i}function h(c,f){const m={};return f.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,s,r){s&&(m[s]=r)}),m}return M}var oe;function me(){if(oe)return O;oe=1;var n=w&&w.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(O,"__esModule",{value:!0}),O.Socket=void 0;const g=he(),l=U(),d=ae(),h=ue(),c=n(F()),f=z,m=H(),i=(0,c.default)("engine.io-client:socket");class s extends f.Emitter{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=(0,h.parse)(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=(0,h.parse)(t.host).host),(0,l.installTimerFunctions)(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=(0,d.decode)(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){i('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=m.protocol,t.transport=e,this.id&&(t.sid=this.id);const o=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return i("options: %j",o),new g.transports[e](o)}open(){let e;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){i("error while creating transport: %s",t),this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){i("setting transport %s",e.name),this.transport&&(i("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){i('probing transport "%s"',e);let t=this.createTransport(e),o=!1;s.priorWebsocketSuccess=!1;const b=()=>{o||(i('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",S=>{if(!o)if(S.type==="pong"&&S.data==="probe"){if(i('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;s.priorWebsocketSuccess=t.name==="websocket",i('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{o||this.readyState!=="closed"&&(i("changing transport and sending upgrade packet"),D(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{i('probe transport "%s" failed',e);const x=new Error("probe error");x.transport=t.name,this.emitReserved("upgradeError",x)}}))};function y(){o||(o=!0,D(),t.close(),t=null)}const a=S=>{const x=new Error("probe error: "+S);x.transport=t.name,y(),i('probe transport "%s" failed because of error: %s',e,S),this.emitReserved("upgradeError",x)};function p(){a("transport closed")}function u(){a("socket closed")}function v(S){t&&S.name!==t.name&&(i('"%s" works - aborting "%s"',S.name,t.name),y())}const D=()=>{t.removeListener("open",b),t.removeListener("error",a),t.removeListener("close",p),this.off("close",u),this.off("upgrading",v)};t.once("open",b),t.once("error",a),t.once("close",p),this.once("close",u),this.once("upgrading",v),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{o||t.open()},200):t.open()}onOpen(){if(i("socket open"),this.readyState="open",s.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){i("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(i('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}else i('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();i("flushing %d packets in socket",e.length),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let o=0;o<this.writeBuffer.length;o++){const b=this.writeBuffer[o].data;if(b&&(t+=(0,l.byteLength)(b)),o>0&&t>this.maxPayload)return i("only send %d out of %d packets",o,this.writeBuffer.length),this.writeBuffer.slice(0,o);t+=2}return i("payload size is %d (max: %d)",t,this.maxPayload),this.writeBuffer}write(e,t,o){return this.sendPacket("message",e,t,o),this}send(e,t,o){return this.sendPacket("message",e,t,o),this}sendPacket(e,t,o,b){if(typeof t=="function"&&(b=t,t=void 0),typeof o=="function"&&(b=o,o=null),this.readyState==="closing"||this.readyState==="closed")return;o=o||{},o.compress=o.compress!==!1;const y={type:e,data:t,options:o};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),b&&this.once("flush",b),this.flush()}close(){const e=()=>{this.onClose("forced close"),i("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},o=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():e()}):this.upgrading?o():e()),this}onError(e){i("socket error %j",e),s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(i('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let o=0;const b=e.length;for(;o<b;o++)~this.transports.indexOf(e[o])&&t.push(e[o]);return t}}return O.Socket=s,s.protocol=m.protocol,O}var ne;function we(){return ne||(ne=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.nextTick=n.parse=n.installTimerFunctions=n.transports=n.Transport=n.protocol=n.Socket=void 0;const g=me();Object.defineProperty(n,"Socket",{enumerable:!0,get:function(){return g.Socket}}),n.protocol=g.Socket.protocol;var l=I();Object.defineProperty(n,"Transport",{enumerable:!0,get:function(){return l.Transport}});var d=he();Object.defineProperty(n,"transports",{enumerable:!0,get:function(){return d.transports}});var h=U();Object.defineProperty(n,"installTimerFunctions",{enumerable:!0,get:function(){return h.installTimerFunctions}});var c=ue();Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return c.parse}});var f=J();Object.defineProperty(n,"nextTick",{enumerable:!0,get:function(){return f.nextTick}})}(X)),X}export{we as r};
